@model IEnumerable<RoomManage.Models.UserViewModel>

@{
    ViewBag.Title = RoomManage.Resources.AccountController.Users;
}

<h2>  @RoomManage.Resources.AccountController.UserList</h2>

<p>
    @Html.ActionLink(RoomManage.Resources.AccountController.AddAdmin, "AddAdmin", null , new {@class  = "btn btn-primary" })
    <a href="#" class="btn  btn-primary getUsers" data-toggle="modal" data-target="#create-admin">@RoomManage.Resources.AccountController.getUsers </a>
    <a href="#" class="btn btn-primary getAdmins" data-toggle="modal" data-target="#create-admin">@RoomManage.Resources.AccountController.getAdmins </a>
</p>
<table class="table user_data">
    <tr>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.UserName)
        </th>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.FullLocation)
        </th>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.PhoneNumber)
        </th>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.Email)
        </th>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.UserType)
        </th>
        <th>
            @Html.DisplayName(RoomManage.Resources.AccountController.Status)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.UserName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.fullAddress)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.PhoneNumber)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Email)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.UserType)
        </td>
        @if (item.status)
        {
            <td >
                <a data-id="@item.Id" class='btn btn-danger activate-status-user'>@RoomManage.Resources.AccountController.DeActiveUserAccount</a>   
            </td>
        }
        else
        {
        <td>
            <a data-id="@item.Id" class='btn btn-success activate-status-user'>@RoomManage.Resources.AccountController.ActiveUserAccount</a>  
        </td>
        }
    </tr>

}

</table>


@section scripts{
    <script>
        $(document).ready(function () {
            $('.activate-status-user').click(function () {
                var me = $(this);
                var confirmMessage = "";
                var addedClass = "";
                var removedClass = "";
                var text = "";
                if (me.hasClass("btn-success")) {
                    confirmMessage = "@RoomManage.Resources.AccountController.ActiveUserAccountConfrimMessage";
                    addedClass = "btn-danger";
                    removedClass = "btn-success";
                    text = "@RoomManage.Resources.AccountController.DeActiveUserAccount";
                } else if(me.hasClass("btn-danger")) {
                    confirmMessage = "@RoomManage.Resources.AccountController.DeActiveUserAccountConfrimMessage";
                    addedClass = "btn-success";
                    removedClass = "btn-danger";
                    text = "@RoomManage.Resources.AccountController.ActiveUserAccount";
                }
                if (confirm(confirmMessage) ){

                    var user_id = me.attr('data-id');
                    $.ajax({
                        url: "activateOrDeActivate",
                        type: "GET",
                        data: { user_id: user_id },
                        error: function (xhr, error) {
                            alert("An error occured: " + xhr.status + " " + xhr.statusText);
                        },
                        success: function (data) {
                            me.removeClass(removedClass);
                            me.addClass(addedClass);
                            me.text(text);
                            alert(data);

                        }
                    });
                }
            });
            // get users
            $('.getUsers').click(function () {
                
                    $.ajax({
                        url: "getUser",
                        type: "GET",
                        data: { },
                        error: function (xhr, error) {
                            alert("An error occured: " + xhr.status + " " + xhr.statusText);
                        },
                        success: function (data) {
                            $(".user_data").find("tbody").html(data);

                        }
                    });
           
            });

            // get admins
            $('.getAdmins').click(function () {

                $.ajax({
                    url: "getAdmins",
                    type: "GET",
                    data: {},
                    error: function (xhr, error) {
                        alert("An error occured: " + xhr.status + " " + xhr.statusText);
                    },
                    success: function (data) {
                        $(".user_data").find("tbody").html(data);

                    }
                });

            });

        });

    </script>
    
    }